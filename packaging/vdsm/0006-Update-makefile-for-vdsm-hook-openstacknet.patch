From 30d304386433a7b90023c23c3c85391e580880b6 Mon Sep 17 00:00:00 2001
From: walteryang47 <walteryang47@users.noreply.github.com>
Date: Sun, 17 Jul 2016 05:29:46 -0400
Subject: [PATCH] Update makefile for vdsm-hook-openstacknet

Add missing after_vm_start entry

Signed-off-by: walteryang47 <walteryang47@users.noreply.github.com>
---
 debian/vdsm-hook-openstacknet.install | 2 ++
 vdsm.spec.in                          | 2 ++
 vdsm_hooks/openstacknet/Makefile.am   | 9 +++++++++
 3 files changed, 13 insertions(+)

diff --git a/debian/vdsm-hook-openstacknet.install b/debian/vdsm-hook-openstacknet.install
index 4e6a2ca..e3b3ff9 100644
--- a/debian/vdsm-hook-openstacknet.install
+++ b/debian/vdsm-hook-openstacknet.install
@@ -15,3 +15,5 @@ usr/libexec/vdsm/hooks/before_device_migrate_destination/50_openstacknet
 usr/libexec/vdsm/hooks/before_device_migrate_destination/openstacknet_utils.py
 usr/libexec/vdsm/hooks/before_nic_hotplug/50_openstacknet
 usr/libexec/vdsm/hooks/before_nic_hotplug/openstacknet_utils.py
+usr/libexec/vdsm/hooks/after_vm_start/50_openstacknet
+usr/libexec/vdsm/hooks/after_vm_start/openstacknet_utils.py
diff --git a/vdsm.spec.in b/vdsm.spec.in
index 17e3ace..e79fb77 100644
--- a/vdsm.spec.in
+++ b/vdsm.spec.in
@@ -1204,6 +1204,8 @@ exit 0
 %{_sysconfdir}/sudoers.d/50_vdsm_hook_openstacknet
 %{_libexecdir}/%{vdsm_name}/hooks/after_device_create/50_openstacknet
 %{_libexecdir}/%{vdsm_name}/hooks/after_device_create/openstacknet_utils.py*
+%{_libexecdir}/%{vdsm_name}/hooks/after_vm_start/50_openstacknet
+%{_libexecdir}/%{vdsm_name}/hooks/after_vm_start/openstacknet_utils.py*
 %{_libexecdir}/%{vdsm_name}/hooks/after_device_destroy/50_openstacknet
 %{_libexecdir}/%{vdsm_name}/hooks/after_device_destroy/openstacknet_utils.py*
 %{_libexecdir}/%{vdsm_name}/hooks/after_device_migrate_destination/50_openstacknet
diff --git a/vdsm_hooks/openstacknet/Makefile.am b/vdsm_hooks/openstacknet/Makefile.am
index da3e470..63438e3 100644
--- a/vdsm_hooks/openstacknet/Makefile.am
+++ b/vdsm_hooks/openstacknet/Makefile.am
@@ -32,6 +32,7 @@ EXTRA_DIST = \
 	after_device_create.py \
 	after_device_destroy.py \
 	before_device_create.py \
+	after_vm_start.py \
 	before_device_migrate_destination.py \
 	$(constsfile) \
 	sudoers.in
@@ -64,6 +65,9 @@ install-data-local: install-data-consts install-data-sudoers
 	$(MKDIR_P) $(DESTDIR)$(vdsmhooksdir)/before_nic_hotplug
 	$(INSTALL_SCRIPT) $(srcdir)/before_device_create.py \
 		$(DESTDIR)$(vdsmhooksdir)/before_nic_hotplug/50_openstacknet
+	$(MKDIR_P) $(DESTDIR)$(vdsmhooksdir)/after_vm_start
+	$(INSTALL_SCRIPT) $(srcdir)/after_vm_start.py \
+		$(DESTDIR)$(vdsmhooksdir)/after_vm_start/50_openstacknet
 
 uninstall-local: uninstall-data-consts uninstall-data-sudoers
 	$(RM) $(DESTDIR)$(vdsmhooksdir)/after_device_create/50_openstacknet
@@ -74,6 +78,7 @@ uninstall-local: uninstall-data-consts uninstall-data-sudoers
 	$(RM) $(DESTDIR)$(vdsmhooksdir)/before_device_create/50_openstacknet
 	$(RM) $(DESTDIR)$(vdsmhooksdir)/before_device_migrate_destination/50_openstacknet
 	$(RM) $(DESTDIR)$(vdsmhooksdir)/before_nic_hotplug/50_openstacknet
+	$(RM) $(DESTDIR)$(vdsmhooksdir)/after_vm_start/50_openstacknet
 
 install-data-consts:
 	$(MKDIR_P) $(DESTDIR)$(vdsmhooksdir)/after_device_create
@@ -100,6 +105,9 @@ install-data-consts:
 	$(MKDIR_P) $(DESTDIR)$(vdsmhooksdir)/before_nic_hotplug
 	$(INSTALL_SCRIPT) $(srcdir)/$(constsfile) \
 		$(DESTDIR)$(vdsmhooksdir)/before_nic_hotplug/$(constsfile)
+	$(MKDIR_P) $(DESTDIR)$(vdsmhooksdir)/after_vm_start
+	$(INSTALL_SCRIPT) $(srcdir)/$(constsfile) \
+		$(DESTDIR)$(vdsmhooksdir)/after_vm_start/$(constsfile)
 
 uninstall-data-consts:
 	$(RM) $(DESTDIR)$(vdsmhooksdir)/after_device_create/$(constsfile)
@@ -110,6 +118,7 @@ uninstall-data-consts:
 	$(RM) $(DESTDIR)$(vdsmhooksdir)/before_device_create/$(constsfile)
 	$(RM) $(DESTDIR)$(vdsmhooksdir)/before_device_migrate_destination/$(constsfile)
 	$(RM) $(DESTDIR)$(vdsmhooksdir)/before_nic_hotplug/$(constsfile)
+	$(RM) $(DESTDIR)$(vdsmhooksdir)/after_vm_start/$(constsfile)
 
 install-data-sudoers:
 	$(MKDIR_P) $(DESTDIR)$(sysconfdir)/sudoers.d
-- 
1.8.3.1

